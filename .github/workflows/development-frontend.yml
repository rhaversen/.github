name: Reusable Development Testing (Frontend)

on:
    workflow_call:
        inputs:
            node_version:
                description: "Node.js version to use"
                required: false
                type: string
                default: "lts/*"
            run_tests:
                description: "Run tests"
                required: false
                type: boolean
                default: true

jobs:
    build-and-test-image:
        runs-on: ubuntu-latest
        steps:
            -   name: Checkout repository
                uses: actions/checkout@v6

            -   name: Setup Node.js
                uses: actions/setup-node@v6
                with:
                    node-version: ${{ inputs.node_version }}
                    cache: "npm"
                    cache-dependency-path: "**/package-lock.json"

            -   name: Install dependencies
                run: npm ci

            -   name: Build
                run: npm run build

            -   name: Set up Docker Buildx
                uses: docker/setup-buildx-action@v3

            -   name: Build Docker image
                run: |
                    docker buildx create --use
                    docker buildx build --file Dockerfile --platform linux/arm64,linux/amd64 .

    test-lint:
        runs-on: ubuntu-latest
        steps:
            -   name: Checkout repository
                uses: actions/checkout@v6

            -   name: Setup Node.js
                uses: actions/setup-node@v6
                with:
                    node-version: ${{ inputs.node_version }}
                    cache: "npm"
                    cache-dependency-path: "**/package-lock.json"

            -   name: Install dependencies
                run: npm ci

            -   name: Lint tests
                run: npm run lint

    test:
        if: ${{ inputs.run_tests }}
        runs-on: ubuntu-latest
        steps:
            -   name: Checkout repository
                uses: actions/checkout@v6

            -   name: Setup Node.js
                uses: actions/setup-node@v6
                with:
                    node-version: ${{ inputs.node_version }}
                    cache: "npm"
                    cache-dependency-path: "**/package-lock.json"

            -   name: Install dependencies
                run: npm ci

            -   name: Run tests
                run: npm test

    spellcheck:
        runs-on: ubuntu-latest
        steps:
            -   name: Checkout repository
                uses: actions/checkout@v6

            -   name: Setup Node.js
                uses: actions/setup-node@v6
                with:
                    node-version: ${{ inputs.node_version }}
                    cache: "npm"
                    cache-dependency-path: "**/package-lock.json"

            -   name: Install dependencies
                run: npm ci

            -   name: Run spellcheck
                run: npm run spellcheck
